module.exports=[18933,e=>{"use strict";var t=e.i(47909),a=e.i(74017),r=e.i(96250),i=e.i(59756),n=e.i(61916),s=e.i(14444),o=e.i(37092),l=e.i(69741),c=e.i(16795),d=e.i(87718),u=e.i(95169),p=e.i(47587),m=e.i(66012),f=e.i(70101),x=e.i(26937),k=e.i(10372),g=e.i(93695);e.i(52474);var h=e.i(220),y=e.i(89171);let R=process.env.GEMINI_API_KEY||"AIzaSyA_nBX7jeA7Ri77Z8Yh0JUQtvq4vtBfYZI",A=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${R}`,E="https://api.canlimenu.com";async function v(e){try{let{message:t,customerCode:a,sessionId:r,menuData:i,pageUrl:n}=await e.json();if(!t||!a)return y.NextResponse.json({success:!1,error:"Message and customerCode are required"},{status:400});console.log("ðŸ” AI Chat API - Request:",{message:t.substring(0,50),customerCode:a,sessionId:r,menuDataLength:i?.length||0,pageUrl:n});try{let e=await fetch(`${E}/api/Chat/ask`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,customerCode:a,sessionId:r||`session_${Date.now()}`,pageUrl:n||"",menuData:i||""}),signal:AbortSignal.timeout(8e3)});if(e.ok){let t=await e.json();if(console.log("âœ… Backend response:",{hasResponse:!!t.response,remainingMessages:t.remainingMessages,rateLimited:t.rateLimited,fallback:t.fallback}),t.rateLimited)return y.NextResponse.json({success:!0,response:t.response,remainingMessages:t.remainingMessages||0,rateLimited:!0});if(t.fallback)throw console.log("âš ï¸ Backend returned fallback flag"),Error("Backend fallback - switching to Gemini");return y.NextResponse.json({success:!0,response:t.response,remainingMessages:t.remainingMessages||30,source:"backend"})}throw console.error("âŒ Backend response not OK:",e.status),Error(`Backend API error: ${e.status}`)}catch(e){console.log("âš ï¸ Backend Chat API failed, falling back to Gemini:",e)}try{console.log("ðŸ”„ Falling back to Gemini AI");let n="";if(i)try{let e="string"==typeof i?JSON.parse(i):i;e&&e.categories&&e.categories.forEach(e=>{e.subCategories&&e.subCategories[0]?.products?(n+=`
${e.title}:
`,e.subCategories[0].products.forEach(e=>{n+=`  - ${e.title}`,e.price>0&&(n+=` (${e.price}â‚º)`),e.detail&&(n+=` - ${e.detail}`),n+="\n"})):e.products&&e.products.length>0&&(n+=`
${e.title}:
`,e.products.forEach(e=>{n+=`  - ${e.title}`,e.price>0&&(n+=` (${e.price}â‚º)`),e.detail&&(n+=` - ${e.detail}`),n+="\n"}))})}catch(e){console.error("Error parsing menu data:",e)}let s=await fetch(`${E}/api/Customer/CustomerInfoByCode?code=${a}`),o=`Sen bir restoran men\xfc asistanÄ±sÄ±n.
`;if(s.ok){let e=await s.json();o=`Sen ${e.name} restoranÄ±nÄ±n men\xfc asistanÄ±sÄ±n.
RESTORAN BÄ°LGÄ°LERÄ° (Bu bilgileri kullan):
- Ä°ÅŸletme AdÄ±: ${e.name}
- Telefon: ${e.phone||"BelirtilmemiÅŸ"}
- Adres/Konum: ${e.location||"BelirtilmemiÅŸ"}
- Instagram: ${e.instagramUrl||"BelirtilmemiÅŸ"}
- WhatsApp: ${e.whatsApp||"BelirtilmemiÅŸ"}
- Fiyat G\xf6sterimi: ${e.showPrices?"Evet":"HayÄ±r"}

KONUM/ADRES SORUSU CEVABI: KullanÄ±cÄ± konum, adres, nerede sorduÄŸunda yukarÄ±daki Adres/Konum bilgisini ver
INSTAGRAM SORUSU CEVABI: Instagram, sosyal medya sorduÄŸunda yukarÄ±daki Instagram bilgisini ver
TELEFON SORUSU CEVABI: Telefon, iletiÅŸim sorduÄŸunda yukarÄ±daki Telefon bilgisini ver
REZERVASYON SORUSU CEVABI: KullanÄ±cÄ± rezervasyon, masa, randevu sorduÄŸunda:
"Rezervasyon i\xe7in bizi arayabilirsiniz: ${e.phone||"Telefon bilgisi bulunamadÄ±"}
ðŸ“ž Telefon: ${e.phone||"BelirtilmemiÅŸ"}
`,e.whatsApp&&(o+=`ðŸ“± WhatsApp: ${e.whatsApp}
`),o+=`Rezervasyon yapmak istediÄŸiniz tarihi ve kiÅŸi sayÄ±sÄ±nÄ± belirterek arayÄ±n!" ÅŸeklinde cevap ver

\xd6ZEL Ä°\xc7ECEK \xd6NERÄ° SÄ°STEMÄ°:
KullanÄ±cÄ± "tatlÄ± kokteyl", "tatlÄ± i\xe7ecek", "kokteyl \xf6ner", "ne i\xe7sem", "enerji i\xe7ecek", "redbull" gibi sorular sorduÄŸunda:
1. \xd6nce men\xfcdeki T\xdcM i\xe7ecekleri kontrol et
2. Ä°stek tipine uygun 2-3 \xfcr\xfcn se\xe7:
   - TatlÄ± istek: Åžarap, kokteyl, tatlÄ± lik\xf6r, meyve suyu, milkshake
   - Alkoll\xfc istek: Kokteyl, viski, ÅŸarap, lik\xf6r, gin tonik
   - SoÄŸuk istek: SoÄŸuk kahve, buz \xe7ayÄ±, smoothie, gazlÄ± i\xe7ecek
   - SÄ±cak istek: Kahve, \xe7ay, sÄ±cak \xe7ikolata, t\xfcrk kahvesi
   - Enerji istek: Redbull, Monster, enerji i\xe7eceÄŸi, kahve, espresso
3. Her \xf6nerdiÄŸin \xfcr\xfcn i\xe7in NEDEN \xf6nerdiÄŸini a\xe7Ä±kla
4. Format: "â€¢ \xdcr\xfcn AdÄ± (Fiyat TL) - Neden a\xe7Ä±klamasÄ±"
5. ASLA men\xfcde olmayan \xfcr\xfcn \xf6nerme!

\xd6ZEL SORULAR:
"Neler yapabilirsin?", "Ne yapÄ±yorsun?", "NasÄ±l yardÄ±m edebilirsin?" sorulduÄŸunda:
"Size ÅŸunlarda yardÄ±mcÄ± olabilirim: ðŸ“‹ Men\xfc kategorilerini listeleme, ðŸ’° \xdcr\xfcn fiyat bilgileri, ðŸ½ï¸ Men\xfc \xf6nerileri verme, ðŸ“ž Telefon ve iletiÅŸim bilgileri, ðŸ“± Instagram ve sosyal medya, ðŸ· Ä°\xe7ecek \xf6nerileri"

MEN\xdc DIÅžI SORULAR:
"CanlÄ± m\xfczik", "etkinlik", "program", "a\xe7Ä±lÄ±ÅŸ saatleri", "rezervasyon ÅŸartlarÄ±" gibi sorularda:
"Bu konuda detaylÄ± bilgi i\xe7in iÅŸletmeyi arayabilir veya sosyal medya hesaplarÄ±nÄ± takip edebilirsiniz" de
ASLA \xf6nce "bilgi verebilirim" deyip sonra "men\xfcde yok" deme!

FÄ°X MEN\xdc SORU KURALLARI:
KullanÄ±cÄ± "fix men\xfc", "set men\xfc", "paket men\xfc", "uygun men\xfc" sorduÄŸunda:
1. \xd6NCELÄ°KLE men\xfc kategorilerinde "FÄ°X MENULER" kategorisi var mÄ± kontrol et
2. Fix men\xfc kategorisi VARSA: SADECE o kategorideki hazÄ±r men\xfcleri listele
3. Fix men\xfc kategorisi YOKSA: "Åžu anda fix men\xfc se\xe7eneÄŸimiz bulunmuyor" de
4. ASLA olmayan fix men\xfc uydurma! ASLA farklÄ± kategorilerden \xfcr\xfcn toplayÄ±p fix men\xfc oluÅŸturma!
5. ASLA rastgele fiyat uydurma! Sadece men\xfcdeki ger\xe7ek fiyatlarÄ± kullan

GENEL \xd6NERI KURALLARI:
"KÄ±z kÄ±z takÄ±lÄ±caz", "arkadaÅŸ", "eÄŸlence" gibi genel sorularda:
1. FarklÄ± kategorilerden uygun \xfcr\xfcnler \xf6nerebilirsin
2. Meze, ana yemek, tatlÄ±, i\xe7ecek kombinasyonu yap
3. Sadece men\xfcdeki ger\xe7ek \xfcr\xfcnleri kullan
4. Format: "â€¢ \xdcr\xfcn (Fiyat TL)" ve sonunda "Toplam: X TL"

KÄ°ÅžÄ° SAYISI FÄ°YAT KURALLARI:
KullanÄ±cÄ± "2 kiÅŸi", "3 kiÅŸi", "4 kiÅŸi" vs. belirttiÄŸinde:
1. Men\xfcdeki fiyatlar TEK KÄ°ÅžÄ°LÄ°KTÄ°R
2. KiÅŸi sayÄ±sÄ± kadar \xc7ARP: 2 kiÅŸi = fiyat x2, 3 kiÅŸi = fiyat x3
3. \xd6rnek: "KarÄ±ÅŸÄ±k Meze (120â‚º)" â†’ 2 kiÅŸi i\xe7in: "KarÄ±ÅŸÄ±k Meze (240â‚º - 2 kiÅŸi i\xe7in)"
4. Toplam hesaplarken \xe7arpÄ±lmÄ±ÅŸ fiyatlarÄ± kullan
5. KiÅŸi baÅŸÄ± bilgi vermek istersen: "120â‚º x 2 kiÅŸi = 240â‚º" ÅŸeklinde a\xe7Ä±kla

`,e.showPrices||(o+=`DÄ°KKAT: FiyatlarÄ± sadece m\xfcÅŸteri \xf6zellikle isterse g\xf6ster.

`)}n&&(o+=`GER\xc7EK MEN\xdc VERÄ°LERÄ° (SADECE BUNLARI KULLAN):
${n}

`),o+=`KRÄ°TÄ°K UYARI: ASLA men\xfcde olmayan \xfcr\xfcn uydurma! SADECE yukarÄ±daki ger\xe7ek men\xfc verilerini kullan. EÄŸer \xfcr\xfcn yoksa 'Bu \xfcr\xfcn men\xfcm\xfczde yok' de!

M\xfcÅŸteri sorusu: ${t}`,console.log("ðŸ“ Context prepared. Menu data length:",n.length);let l={contents:[{parts:[{text:o}]}],generationConfig:{temperature:.3,topK:10,topP:.8,maxOutputTokens:1024}},c=await fetch(A,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(2e4)});if(!c.ok){let e=await c.text();throw console.error("Gemini API error:",e),Error(`Gemini API error: ${c.status}`)}let d=(await c.json()).candidates[0].content.parts[0].text;try{await fetch(`${E}/api/ChatAnalytics/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerCode:a,customerName:"",userMessage:t,aiResponse:d,sessionId:r||`session_${Date.now()}`,pageUrl:e.nextUrl.href})})}catch(e){}return y.NextResponse.json({success:!0,response:d,remainingMessages:30,source:"gemini"})}catch(e){throw console.error("Gemini API failed:",e),e}}catch(e){return console.error("AI Chat API Error:",e),y.NextResponse.json({success:!1,error:"Åžu anda teknik bir sorun yaÅŸÄ±yoruz. LÃ¼tfen birkaÃ§ dakika sonra tekrar deneyin.",response:"Åžu anda teknik bir sorun yaÅŸÄ±yoruz. LÃ¼tfen birkaÃ§ dakika sonra tekrar deneyin."})}}e.s(["POST",()=>v],46004);var b=e.i(46004);let S=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/ai/chat/route",pathname:"/api/ai/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/ai/chat/route.ts",nextConfigOutput:"",userland:b}),{workAsyncStorage:C,workUnitAsyncStorage:w,serverHooks:N}=S;function T(){return(0,r.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:w})}async function I(e,t,r){S.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/ai/chat/route";y=y.replace(/\/index$/,"")||"/";let R=await S.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!R)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:A,params:E,nextConfig:v,parsedUrl:b,isDraftMode:C,prerenderManifest:w,routerServerContext:N,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,resolvedPathname:L,clientReferenceManifest:M,serverActionsManifest:O}=R,K=(0,l.normalizeAppPath)(y),U=!!(w.dynamicRoutes[K]||w.routes[L]),P=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,b,!1):t.end("This page could not be found"),null);if(U&&!C){let e=!!w.routes[L],t=w.dynamicRoutes[K];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await P();throw new g.NoFallbackError}}let $=null;!U||S.isDev||C||($="/index"===($=L)?"/":$);let B=!0===S.isDev||!U,z=U&&!B;O&&M&&(0,s.setReferenceManifestsSingleton)({page:y,clientReferenceManifest:M,serverActionsManifest:O,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:O})});let _=e.method||"GET",D=(0,n.getTracer)(),j=D.getActiveScopeSpan(),F={params:E,prerenderManifest:w,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>S.onRequestError(e,t,r,N)},sharedContext:{buildId:A}},H=new c.NodeNextRequest(e),q=new c.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(H,(0,d.signalFromNodeResponse)(t));try{let s=async e=>S.handle(G,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=D.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${_} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${_} ${y}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var n,l;let c=async({previousCacheEntry:a})=>{try{if(!o&&T&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await s(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=F.renderOpts.collectedTags;if(!U)return await (0,m.sendResponse)(H,q,n,F.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(n.headers);c&&(t[k.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=k.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,r=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=k.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:T})},N),t}},d=await S.handleResponse({req:e,nextConfig:v,cacheKey:$,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:w,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:o});if(!U)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&U||u.delete(k.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,x.getCacheControlHeader)(d.cacheControl)),await (0,m.sendResponse)(H,q,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};j?await l(j):await D.withPropagatedContext(e.headers,()=>D.trace(u.BaseServerSpan.handleRequest,{spanName:`${_} ${y}`,kind:n.SpanKind.SERVER,attributes:{"http.method":_,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:K,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:T})}),U)throw t;return await (0,m.sendResponse)(H,q,new Response(null,{status:500})),null}}e.s(["handler",()=>I,"patchFetch",()=>T,"routeModule",()=>S,"serverHooks",()=>N,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>w],18933)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_4d7b45bc.js.map